# ä¸ç‰ˆé‡åŒ–äº¤æ˜“ç³»ç»Ÿ - è®¾è®¡æ–‡æ¡£

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç›®æ ‡
æ„å»ºä¸€ä¸ªè½»é‡çº§çš„é‡åŒ–äº¤æ˜“è¾…åŠ©ç³»ç»Ÿï¼Œé€šè¿‡ç»“åˆå±€åŸŸç½‘LLMå’Œäº‘ç«¯LLMï¼Œä¸ºç”¨æˆ·æä¾›ä¸ªè‚¡è¯Šæ–­ã€é€‰è‚¡ç­–ç•¥ã€æ“ä½œå»ºè®®ç­‰åŠŸèƒ½ã€‚

### 1.2 MVPç›®æ ‡ï¼ˆä¸ªè‚¡è¯Šæ–­åŠŸèƒ½ï¼‰
- ç”¨æˆ·è¾“å…¥è‚¡ç¥¨ä»£ç 
- ç³»ç»Ÿè‡ªåŠ¨è·å–è¯¥è‚¡ç¥¨çš„ç›¸å…³æ•°æ®
- å±€åŸŸç½‘LLMå¤„ç†å’Œç»“æ„åŒ–æ•°æ®
- äº‘ç«¯LLMåˆ†æå¹¶ç»™å‡ºå½“æ—¥ã€æœ¬å‘¨ã€é•¿çº¿æ“ä½œå»ºè®®
- å‰ç«¯å±•ç¤ºåˆ†æç»“æœ

### 1.3 ç¡¬ä»¶ç¯å¢ƒ
- GPU: 64GBæ˜¾å­˜
- å±€åŸŸç½‘æ¨¡å‹: NVIDIA-Nemotron-3-Nano-30B-A3B (é€šè¿‡ llama.cpp éƒ¨ç½²)
- äº‘ç«¯æ¨¡å‹: DeepSeek-V3 (é»˜è®¤)

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           å‰ç«¯ (Vue 3 + Vite)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ä¸ªè‚¡è¯Šæ–­   â”‚  â”‚  é€‰è‚¡ç­›é€‰   â”‚  â”‚  çƒ­é—¨æ‰«æ   â”‚  â”‚  æ“ä½œè®°å½•   â”‚ â”‚
â”‚  â”‚   (MVP)    â”‚  â”‚  (å¾…å¼€å‘)   â”‚  â”‚  (å¾…å¼€å‘)   â”‚  â”‚  (å¾…å¼€å‘)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ HTTP/REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         åç«¯ (Flask)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   APIè·¯ç”±å±‚    â”‚  â”‚    æœåŠ¡å±‚        â”‚  â”‚     å·¥å…·å±‚           â”‚  â”‚
â”‚  â”‚  /api/stock    â”‚  â”‚  DataService    â”‚  â”‚  Promptsæ¨¡æ¿        â”‚  â”‚
â”‚  â”‚  /api/analysis â”‚  â”‚  LLMService     â”‚  â”‚  RateLimiter(é¢„ç•™)  â”‚  â”‚
â”‚  â”‚  /api/operationâ”‚  â”‚  CacheService   â”‚  â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                   â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®æº       â”‚    â”‚  LLMå±‚       â”‚    â”‚  å­˜å‚¨å±‚      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚  AKShare     â”‚    â”‚  å±€åŸŸç½‘LLM   â”‚    â”‚  SQLite     â”‚
â”‚  (è‚¡ç¥¨æ•°æ®)   â”‚    â”‚  (llama.cpp) â”‚    â”‚  (æ•°æ®åº“)    â”‚
â”‚              â”‚    â”‚              â”‚    â”‚              â”‚
â”‚              â”‚    â”‚  äº‘ç«¯LLM     â”‚    â”‚  å†…å­˜ç¼“å­˜    â”‚
â”‚              â”‚    â”‚  (DeepSeek)  â”‚    â”‚  (L1 Cache) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 é¡¹ç›®ç›®å½•ç»“æ„

```
Ghetto-style-Quant-Trading/
â”œâ”€â”€ backend/                        # åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ __init__.py            # Flaskåº”ç”¨åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ models/                # æ•°æ®åº“æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stock.py           # è‚¡ç¥¨æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â””â”€â”€ analysis.py        # åˆ†æç»“æœæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ services/              # ä¸šåŠ¡æœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ data_service.py    # æ•°æ®è·å–æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ llm_service.py     # LLMè°ƒç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ local_llm.py       # å±€åŸŸç½‘LLMå°è£…
â”‚   â”‚   â”‚   â”œâ”€â”€ cloud_llm.py       # äº‘ç«¯LLMå°è£…
â”‚   â”‚   â”‚   â””â”€â”€ cache_service.py   # ç¼“å­˜æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ api/                   # APIè·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ stock.py           # è‚¡ç¥¨ç›¸å…³API
â”‚   â”‚   â”‚   â””â”€â”€ analysis.py        # åˆ†æç›¸å…³API
â”‚   â”‚   â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ prompts.py         # Promptæ¨¡æ¿
â”‚   â”‚       â””â”€â”€ rate_limiter.py    # é¢‘ç‡é™åˆ¶ï¼ˆé¢„ç•™ï¼‰
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ llm_config.json        # å±€åŸŸç½‘LLMé…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â””â”€â”€ run.py                     # å¯åŠ¨å…¥å£
â”‚
â”œâ”€â”€ frontend/                       # å‰ç«¯æœåŠ¡
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/            # Vueç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ StockInput.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ StockInfo.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalysisCard.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalysisResult.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ TechnicalIndicators.vue
â”‚   â”‚   â”‚   â””â”€â”€ LoadingSpinner.vue
â”‚   â”‚   â”œâ”€â”€ views/                 # é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.vue
â”‚   â”‚   â”‚   â””â”€â”€ StockDiagnosis.vue
â”‚   â”‚   â”œâ”€â”€ api/                   # APIè°ƒç”¨
â”‚   â”‚   â”‚   â””â”€â”€ stock.js
â”‚   â”‚   â”œâ”€â”€ stores/                # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ stock.js
â”‚   â”‚   â”œâ”€â”€ router/                # è·¯ç”±
â”‚   â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â””â”€â”€ main.js
â”‚   â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ vite.config.js
â”‚
â”œâ”€â”€ data/                           # æ•°æ®å­˜å‚¨
â”‚   â””â”€â”€ quant.db                   # SQLiteæ•°æ®åº“
â”‚
â”œâ”€â”€ docs/                           # æ–‡æ¡£
â”‚   â””â”€â”€ design.md                  # è®¾è®¡æ–‡æ¡£
â”‚
â”œâ”€â”€ ä¸ç‰ˆé‡åŒ–äº¤æ˜“.md                  # åŸå§‹æ€ç»´å¯¼å›¾
â””â”€â”€ README.md
```

---

## 3. é…ç½®ç®¡ç†

### 3.1 äº‘ç«¯LLMé…ç½®ï¼ˆç¯å¢ƒå˜é‡ï¼‰

äº‘ç«¯æ¨¡å‹çš„APIå¯†é’¥é€šè¿‡**ç³»ç»Ÿç¯å¢ƒå˜é‡**é…ç½®ï¼Œç¡®ä¿å®‰å…¨æ€§ï¼š

```bash
# Windows PowerShell
$env:CLOUD_API_KEY = "your-api-key-here"
$env:CLOUD_BASE_URL = "https://api.deepseek.com"  # å¯é€‰ï¼Œæœ‰é»˜è®¤å€¼

# Linux/Mac
export CLOUD_API_KEY="your-api-key-here"
export CLOUD_BASE_URL="https://api.deepseek.com"
```

**æ”¯æŒçš„ç¯å¢ƒå˜é‡ï¼š**

| å˜é‡å           | è¯´æ˜         | é»˜è®¤å€¼                     |
| ---------------- | ------------ | -------------------------- |
| `CLOUD_API_KEY`  | äº‘ç«¯ APIå¯†é’¥ | å¿…å¡«                       |
| `CLOUD_BASE_URL` | äº‘ç«¯ APIåœ°å€ | `https://api.deepseek.com` |
| `CLOUD_MODEL`    | ä½¿ç”¨çš„æ¨¡å‹   | `deepseek-chat`            |

> æ³¨ï¼šæ”¯æŒä»»ä½•å…¼å®¹ OpenAI API æ ¼å¼çš„äº‘ç«¯æ¨¡å‹æœåŠ¡ï¼Œå¦‚ DeepSeekã€MiniMaxã€Kimi ç­‰ã€‚

### 3.2 å±€åŸŸç½‘LLMé…ç½®ï¼ˆé…ç½®æ–‡ä»¶ï¼‰

å±€åŸŸç½‘éƒ¨ç½²çš„æ¨¡å‹é€šè¿‡**é…ç½®æ–‡ä»¶**ç®¡ç†ï¼Œä½äº `backend/config/llm_config.json`ï¼š

```json
{
    "local_llm": {
        "enabled": true,
        "provider": "llama_cpp",
        "api_url": "http://192.168.1.100:8080",
        "api_key": "",
        "model": "nemotron-30b",
        "timeout": 120,
        "max_tokens": 4096,
        "temperature": 0.7
    },
    "fallback": {
        "enabled": true,
        "use_cloud_on_local_failure": true
    }
}
```

**é…ç½®é¡¹è¯´æ˜ï¼š**

| é…ç½®é¡¹        | è¯´æ˜                               |
| ------------- | ---------------------------------- |
| `enabled`     | æ˜¯å¦å¯ç”¨å±€åŸŸç½‘LLM                  |
| `provider`    | éƒ¨ç½²æ–¹å¼ï¼Œæ”¯æŒ `llama_cpp`         |
| `api_url`     | llama.cpp serverçš„APIåœ°å€          |
| `api_key`     | APIå¯†é’¥ï¼ˆå¦‚æœllama.cppé…ç½®äº†è®¤è¯ï¼‰ |
| `model`       | æ¨¡å‹åç§°                           |
| `timeout`     | è¯·æ±‚è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰                 |
| `max_tokens`  | æœ€å¤§ç”Ÿæˆtokenæ•°                    |
| `temperature` | ç”Ÿæˆæ¸©åº¦                           |

### 3.3 é…ç½®åŠ è½½ä¼˜å…ˆçº§

```python
# config.py é…ç½®åŠ è½½é€»è¾‘

class Config:
    # äº‘ç«¯LLM - ä»ç¯å¢ƒå˜é‡è¯»å–
    CLOUD_LLM_API_KEY = os.environ.get('CLOUD_API_KEY')
    CLOUD_LLM_BASE_URL = os.environ.get('CLOUD_BASE_URL', 'https://api.deepseek.com')
    CLOUD_LLM_MODEL = os.environ.get('CLOUD_MODEL', 'deepseek-chat')
    
    # å±€åŸŸç½‘LLM - ä»é…ç½®æ–‡ä»¶è¯»å–
    LOCAL_LLM_CONFIG = load_json_config('config/llm_config.json')
```

---

## 4. æ•°æ®åº“è®¾è®¡

### 4.1 ERå›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     stock       â”‚       â”‚    stock_daily      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ code (PK)       â”‚â”€â”€â”€â”   â”‚ id (PK)             â”‚
â”‚ name            â”‚   â”‚   â”‚ code (FK)           â”‚
â”‚ industry        â”‚   â””â”€â”€>â”‚ trade_date          â”‚
â”‚ market          â”‚       â”‚ open, close, high   â”‚
â”‚ updated_at      â”‚       â”‚ low, volume, amount â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ turnover, change_pctâ”‚
        â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚         â”‚   analysis_cache    â”‚
        â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â””â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ id (PK)             â”‚
                  â”‚ code (FK)           â”‚
                  â”‚ analysis_type       â”‚
                  â”‚ data_hash           â”‚
                  â”‚ prompt              â”‚
                  â”‚ result              â”‚
                  â”‚ created_at          â”‚
                  â”‚ expires_at          â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 è¡¨ç»“æ„SQL

```sql
-- è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯è¡¨
CREATE TABLE stock (
    code VARCHAR(10) PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    industry VARCHAR(50),
    market VARCHAR(10),
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- è‚¡ç¥¨æ—¥çº¿æ•°æ®è¡¨
CREATE TABLE stock_daily (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code VARCHAR(10) NOT NULL,
    trade_date DATE NOT NULL,
    open REAL,
    close REAL,
    high REAL,
    low REAL,
    volume REAL,
    amount REAL,
    turnover REAL,
    change_pct REAL,
    FOREIGN KEY (code) REFERENCES stock(code),
    UNIQUE(code, trade_date)
);

-- åˆ†æç»“æœç¼“å­˜è¡¨
CREATE TABLE analysis_cache (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code VARCHAR(10) NOT NULL,
    analysis_type VARCHAR(20) NOT NULL,
    data_hash VARCHAR(64),
    prompt TEXT,
    result TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    expires_at DATETIME,
    FOREIGN KEY (code) REFERENCES stock(code)
);

-- ç”¨æˆ·æ“ä½œè®°å½•è¡¨
CREATE TABLE user_operation (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    code VARCHAR(10) NOT NULL,
    operation_type VARCHAR(20) NOT NULL,
    price REAL,
    quantity INTEGER,
    notes TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (code) REFERENCES stock(code)
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_stock_daily_code ON stock_daily(code);
CREATE INDEX idx_stock_daily_date ON stock_daily(trade_date);
CREATE INDEX idx_analysis_cache_code ON analysis_cache(code);
CREATE INDEX idx_analysis_cache_type ON analysis_cache(analysis_type);
```

---

## 5. APIæ¥å£è®¾è®¡

### 5.1 æ¥å£æ€»è§ˆ

| æ–¹æ³•     | è·¯å¾„                         | è¯´æ˜                 |
| -------- | ---------------------------- | -------------------- |
| `GET`    | `/api/stock/{code}`          | è·å–è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯     |
| `GET`    | `/api/stock/{code}/daily`    | è·å–è‚¡ç¥¨æ—¥çº¿æ•°æ®     |
| `POST`   | `/api/analysis/diagnose`     | ä¸ªè‚¡è¯Šæ–­ï¼ˆæ ¸å¿ƒæ¥å£ï¼‰ |
| `GET`    | `/api/analysis/cache/{code}` | è·å–ç¼“å­˜çš„åˆ†æç»“æœ   |
| `DELETE` | `/api/analysis/cache/{code}` | æ¸…é™¤ç¼“å­˜             |
| `POST`   | `/api/operation`             | è®°å½•ç”¨æˆ·æ“ä½œ         |
| `GET`    | `/api/operation/history`     | è·å–æ“ä½œå†å²         |
| `GET`    | `/api/health`                | å¥åº·æ£€æŸ¥             |

### 5.2 æ ¸å¿ƒæ¥å£ï¼šä¸ªè‚¡è¯Šæ–­

**è¯·æ±‚**
```http
POST /api/analysis/diagnose
Content-Type: application/json

{
    "code": "000001",
    "strategy_preference": "ç¨³å¥å‹",
    "force_refresh": false
}
```

**å“åº”**
```json
{
    "code": 200,
    "message": "success",
    "data": {
        "stock_info": {
            "code": "000001",
            "name": "å¹³å®‰é“¶è¡Œ",
            "industry": "é“¶è¡Œ",
            "current_price": 12.35,
            "change_pct": 1.23
        },
        "analysis": {
            "summary": "å¹³å®‰é“¶è¡Œå½“å‰å¤„äºéœ‡è¡æ•´ç†é˜¶æ®µ...",
            "daily": {
                "trend": "éœ‡è¡",
                "suggestion": "è§‚æœ›",
                "confidence": 0.75,
                "reason": "ä»Šæ—¥æˆäº¤é‡èç¼©ï¼ŒçŸ­æœŸæ— æ˜ç¡®æ–¹å‘..."
            },
            "weekly": {
                "trend": "å¼±åŠ¿",
                "suggestion": "å‡ä»“",
                "confidence": 0.68,
                "reason": "å‘¨çº¿MACDæ­»å‰ï¼ŒçŸ­æœŸæ‰¿å‹..."
            },
            "longterm": {
                "trend": "ä¸­æ€§",
                "suggestion": "æŒæœ‰",
                "confidence": 0.72,
                "reason": "ä¼°å€¼å¤„äºå†å²ä½ä½ï¼Œé•¿æœŸå…·å¤‡é…ç½®ä»·å€¼..."
            },
            "technical_indicators": {
                "ma5": 12.20,
                "ma10": 12.15,
                "ma20": 12.30,
                "macd": {"value": -0.05, "signal": "æ­»å‰"},
                "kdj": {"k": 25, "d": 30, "j": 15, "signal": "è¶…å–"},
                "rsi": 45.2
            }
        },
        "cached": false,
        "generated_at": "2026-02-01T08:30:00Z"
    }
}
```

---

## 6. LLMè°ƒç”¨ç­–ç•¥

### 6.1 è°ƒç”¨æµç¨‹

```
ç”¨æˆ·è¯·æ±‚
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥ç¼“å­˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚ å‘½ä¸­?   â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     æ˜¯ â”‚    â”‚ å¦
        â”‚    â”‚
        â–¼    â–¼
   è¿”å›ç¼“å­˜  è·å–è‚¡ç¥¨æ•°æ®(AKShare)
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  å±€åŸŸç½‘LLM      â”‚
        â”‚  æ•°æ®ç»“æ„åŒ–å¤„ç†  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  äº‘ç«¯LLM        â”‚
        â”‚  åˆ†æä¸å»ºè®®ç”Ÿæˆ  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
           å­˜å…¥ç¼“å­˜
                 â”‚
                 â–¼
           è¿”å›ç»“æœ
```

### 6.2 å±€åŸŸç½‘LLMè°ƒç”¨ï¼ˆllama.cppï¼‰

```python
# local_llm.py
import httpx
from app.config import Config

class LocalLLM:
    def __init__(self):
        config = Config.LOCAL_LLM_CONFIG.get('local_llm', {})
        self.enabled = config.get('enabled', False)
        self.api_url = config.get('api_url', 'http://localhost:8080')
        self.api_key = config.get('api_key', '')
        self.timeout = config.get('timeout', 120)
        self.max_tokens = config.get('max_tokens', 4096)
        self.temperature = config.get('temperature', 0.7)
    
    async def complete(self, prompt: str) -> str:
        """è°ƒç”¨å±€åŸŸç½‘LLMï¼ˆllama.cpp serverï¼‰"""
        if not self.enabled:
            raise RuntimeError("å±€åŸŸç½‘LLMæœªå¯ç”¨")
        
        headers = {}
        if self.api_key:
            headers['Authorization'] = f'Bearer {self.api_key}'
        
        # llama.cpp server å…¼å®¹ OpenAI API æ ¼å¼
        payload = {
            "messages": [
                {"role": "user", "content": prompt}
            ],
            "max_tokens": self.max_tokens,
            "temperature": self.temperature
        }
        
        async with httpx.AsyncClient(timeout=self.timeout) as client:
            response = await client.post(
                f"{self.api_url}/v1/chat/completions",
                json=payload,
                headers=headers
            )
            response.raise_for_status()
            result = response.json()
            return result['choices'][0]['message']['content']
```

### 6.3 äº‘ç«¯LLMè°ƒç”¨

```python
# cloud_llm.py
import os
import httpx

class CloudLLM:
    def __init__(self):
        self.api_key = os.environ.get('CLOUD_API_KEY')
        self.base_url = os.environ.get('CLOUD_BASE_URL', 'https://api.deepseek.com')
        self.model = os.environ.get('CLOUD_MODEL', 'deepseek-chat')
        
        if not self.api_key:
            raise ValueError("æœªé…ç½® CLOUD_API_KEY ç¯å¢ƒå˜é‡")
    
    async def complete(self, prompt: str, system_prompt: str = None) -> str:
        """è°ƒç”¨äº‘ç«¯LLM"""
        messages = []
        if system_prompt:
            messages.append({"role": "system", "content": system_prompt})
        messages.append({"role": "user", "content": prompt})
        
        payload = {
            "model": self.model,
            "messages": messages,
            "max_tokens": 2000,
            "temperature": 0.7
        }
        
        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }
        
        async with httpx.AsyncClient(timeout=60) as client:
            response = await client.post(
                f"{self.base_url}/v1/chat/completions",
                json=payload,
                headers=headers
            )
            response.raise_for_status()
            result = response.json()
            return result['choices'][0]['message']['content']
```

---

## 7. ç¼“å­˜ç­–ç•¥

### 7.1 ä¸¤çº§ç¼“å­˜

| å±‚çº§ | å­˜å‚¨                       | TTL         | ç”¨é€”             |
| ---- | -------------------------- | ----------- | ---------------- |
| L1   | å†…å­˜ (cachetools.TTLCache) | 5åˆ†é’Ÿ       | çƒ­ç‚¹æ•°æ®å¿«é€Ÿè®¿é—® |
| L2   | SQLite (analysis_cacheè¡¨)  | å½“æ—¥/å‘¨/7å¤© | æŒä¹…åŒ–ç¼“å­˜       |

### 7.2 ç¼“å­˜è¿‡æœŸè§„åˆ™

| åˆ†æç±»å‹            | è¿‡æœŸæ—¶é—´        |
| ------------------- | --------------- |
| æ—¥å†…åˆ†æ (daily)    | å½“æ—¥15:30åè¿‡æœŸ |
| å‘¨åº¦åˆ†æ (weekly)   | æœ¬å‘¨æ—¥è¿‡æœŸ      |
| é•¿çº¿åˆ†æ (longterm) | 7å¤©åè¿‡æœŸ       |

### 7.3 ç¼“å­˜å¤±æ•ˆæ¡ä»¶

1. **æ—¶é—´è¿‡æœŸ**ï¼šè¶…è¿‡TTLè‡ªåŠ¨å¤±æ•ˆ
2. **æ•°æ®å˜æ›´**ï¼šé€šè¿‡ `data_hash` åˆ¤æ–­æ•°æ®æ˜¯å¦å˜åŒ–
3. **æ‰‹åŠ¨åˆ·æ–°**ï¼šç”¨æˆ·è®¾ç½® `force_refresh=true`

---

## 8. å‰ç«¯è®¾è®¡

### 8.1 é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ ä¸ç‰ˆé‡åŒ–äº¤æ˜“                           [âš™ï¸ è®¾ç½®]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ” è¾“å…¥è‚¡ç¥¨ä»£ç æˆ–åç§°                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚  â”‚
â”‚  â”‚  â”‚ 000001                   â”‚  â”‚  ğŸ“Š è¯Šæ–­   â”‚          â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  ç­–ç•¥åå¥½: â—‰ ç¨³å¥å‹  â—‹ æ¿€è¿›å‹  â—‹ ä»·å€¼å‹                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ“ˆ å¹³å®‰é“¶è¡Œ (000001)                                   â”‚  â”‚
â”‚  â”‚  å½“å‰ä»·: Â¥12.35  æ¶¨è·Œå¹…: +1.23%  æˆäº¤é‡: 12.5ä¸‡æ‰‹        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚   ğŸ“… å½“æ—¥    â”‚ â”‚   ğŸ“… æœ¬å‘¨    â”‚ â”‚   ğŸ“ˆ é•¿çº¿    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  è¶‹åŠ¿: éœ‡è¡  â”‚ â”‚  è¶‹åŠ¿: å¼±åŠ¿  â”‚ â”‚  è¶‹åŠ¿: ä¸­æ€§  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  å»ºè®®: è§‚æœ›  â”‚ â”‚  å»ºè®®: å‡ä»“  â”‚ â”‚  å»ºè®®: æŒæœ‰  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  ç½®ä¿¡åº¦: 75% â”‚ â”‚  ç½®ä¿¡åº¦: 68% â”‚ â”‚  ç½®ä¿¡åº¦: 72% â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  ğŸ“ ç»¼åˆåˆ†æ                                            â”‚  â”‚
â”‚  â”‚  å¹³å®‰é“¶è¡Œå½“å‰å¤„äºéœ‡è¡æ•´ç†é˜¶æ®µï¼Œä»Šæ—¥æˆäº¤é‡èç¼©...          â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â”‚  ğŸ“Š æŠ€æœ¯æŒ‡æ ‡                                            â”‚  â”‚
â”‚  â”‚  MA5: 12.20 | MA10: 12.15 | MA20: 12.30                â”‚  â”‚
â”‚  â”‚  MACD: æ­»å‰ | KDJ: è¶…å– | RSI: 45.2                    â”‚  â”‚
â”‚  â”‚                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  ğŸ”„ åˆ·æ–°åˆ†æ   â”‚  â”‚  ğŸ’¾ è®°å½•æ“ä½œ   â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 8.2 æŠ€æœ¯æ ˆ

- **æ¡†æ¶**: Vue 3 + Vite
- **UIåº“**: Element Plus
- **çŠ¶æ€ç®¡ç†**: Pinia
- **è·¯ç”±**: Vue Router 4
- **HTTPå®¢æˆ·ç«¯**: Axios

---

## 9. å¼€å‘è®¡åˆ’

### Phase 1: é¡¹ç›®åˆå§‹åŒ– âœ…
- [x] åˆ›å»ºé¡¹ç›®ç›®å½•ç»“æ„
- [ ] åˆå§‹åŒ–åç«¯Flaské¡¹ç›®
- [ ] åˆå§‹åŒ–å‰ç«¯Vue 3é¡¹ç›®
- [ ] é…ç½®æ•°æ®åº“

### Phase 2: åç«¯æ ¸å¿ƒåŠŸèƒ½
- [ ] å®ç°æ•°æ®æœåŠ¡æ¨¡å—ï¼ˆAKShareé›†æˆï¼‰
- [ ] å®ç°å±€åŸŸç½‘LLMè°ƒç”¨æ¨¡å—
- [ ] å®ç°äº‘ç«¯LLMè°ƒç”¨æ¨¡å—
- [ ] å®ç°ç¼“å­˜æœåŠ¡æ¨¡å—
- [ ] å®ç°ä¸ªè‚¡è¯Šæ–­API

### Phase 3: å‰ç«¯MVP
- [ ] å®ç°è‚¡ç¥¨è¾“å…¥ç»„ä»¶
- [ ] å®ç°åˆ†æç»“æœå±•ç¤ºç»„ä»¶
- [ ] å®ç°æŠ€æœ¯æŒ‡æ ‡ç»„ä»¶
- [ ] é¡µé¢é›†æˆä¸è”è°ƒ

### Phase 4: æµ‹è¯•ä¸ä¼˜åŒ–
- [ ] æ¥å£æµ‹è¯•
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
